
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>main &#8212; Reyansh Bahl&#39;s FBLA Quizzer 2021 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for main</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;FBLA Main</span>
<span class="sd">.. moduleauthor:: Reyansh Bahl &lt;https://github.com/reybahl&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">databaseconnect</span> <span class="k">import</span> <span class="n">Connection</span>
<span class="kn">from</span> <span class="nn">checkanswers</span> <span class="k">import</span> <span class="n">convert_to_dict</span><span class="p">,</span> <span class="n">check</span>
<span class="kn">import</span> <span class="nn">pdfkit</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">quiz</span> <span class="k">import</span> <span class="n">Quiz</span>

<span class="kn">from</span> <span class="nn">settings</span> <span class="k">import</span> <span class="n">Settings</span>
<span class="kn">from</span> <span class="nn">reports</span> <span class="k">import</span> <span class="n">Reports</span>
<span class="kn">from</span> <span class="nn">intelligentqa</span> <span class="k">import</span> <span class="n">IntelligentQA</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&quot;FBLA&quot;</span>


<div class="viewcode-block" id="start"><a class="viewcode-back" href="../index.html#main.start">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Main route -- Invoked when user visits domain</span>
<span class="sd">    When this function is invoked, the user is redirected to a login</span>
<span class="sd">    screen where users can login via email/password or Google sign-in.</span>
<span class="sd">    Users can also reset their password on login page.</span>

<span class="sd">    :return: Response object as a result of redirecting to the login page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>  <span class="c1"># Redirecting to login on start</span></div>


<div class="viewcode-block" id="login"><a class="viewcode-back" href="../index.html#main.login">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Login page, redirected from main. If the user is already logged in</span>
<span class="sd">    it redirects them straight to the dashboard, otherwise show the login page.</span>
<span class="sd">    At login screen, users first need to register (if not already registered)</span>
<span class="sd">    and then enter their email and password. Alternatively they can also</span>
<span class="sd">    use their Google Account to sign-in. They can also reset their password</span>
<span class="sd">    in case they forget. For reset, they will need to enter the email id</span>
<span class="sd">    that was used to register and on clicking reset, an email will be sent</span>
<span class="sd">    to the user where they can click on a link and reset their password.</span>

<span class="sd">    :return: Response object as a result of redirecting to the dashboard if </span>
<span class="sd">             user is already logged in, other response object for loginpagefirebase.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Checks if it got a post request</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># Gets form data</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span>
        <span class="c1"># Gets email from the form</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="c1"># Creates a session</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
        <span class="k">return</span> <span class="s2">&quot;Logged in&quot;</span>
        
    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;loginpagefirebase.html&#39;</span><span class="p">)</span>  <span class="c1"># Shows the login html page</span></div>


<div class="viewcode-block" id="dashboard"><a class="viewcode-back" href="../index.html#main.dashboard">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/dashboard&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dashboard</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Dashboard page, redirected from login screen. This page presents options to the </span>
<span class="sd">    user to take a quiz, view reports etc. By default the selection option is to take</span>
<span class="sd">    a quiz. If user already has a quiz in progress, user can see buttons to resume</span>
<span class="sd">    existing quiz or take a new quiz.</span>

<span class="sd">    :return: Response object which contains dashboard html with quiz tab selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the user comes directly to the dashboard without the login page, it checks the session to check if the user is signed in</span>
    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># Gets a quiz in progress</span>

        <span class="n">quiz</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">get_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
        <span class="c1"># Checks if a quiz in progress exists</span>
        <span class="n">quiz_in_progress</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">quiz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="c1"># Shows dashboard and specifies if the user has a quiz in progress</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                                <span class="n">quiz_in_progress</span><span class="o">=</span><span class="n">quiz_in_progress</span><span class="p">)</span>

    
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># If the user is not signed in, then redirects them back to the sign in page</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="quiz"><a class="viewcode-back" href="../index.html#main.quiz">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/quiz&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">quiz</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Quiz page, redirected from dashboard. Here code first checks to see if the </span>
<span class="sd">    user already has a quiz in progress, if yes, it get the current state of the quiz</span>
<span class="sd">    from the database. If the user clicked on start a new quiz, this method generates</span>
<span class="sd">    a new quiz.</span>

<span class="sd">    :return: Response object of quiz in progress or a new quiz based upon what user selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">get_quiz_in_progress</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quiz_in_progress&#39;</span><span class="p">)</span>  <span class="c1"># Gets url argument specifying if the user wants a quiz in progress or wants to start a new one.</span>
        
        <span class="k">if</span> <span class="n">get_quiz_in_progress</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">quiz_in_progress</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">get_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">quiz_in_progress</span><span class="p">[</span><span class="s1">&#39;timeTaken&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">totalSeconds</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">seconds</span>
            <span class="k">if</span> <span class="n">quiz_in_progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get correct answers of the quiz progress from the database</span>
                <span class="n">questions_answers</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">get_correct_answers</span><span class="p">(</span><span class="n">quiz_in_progress</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;quizinprogress.html&#39;</span><span class="p">,</span> <span class="n">quizqa</span><span class="o">=</span><span class="n">quiz_in_progress</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">],</span> <span class="n">totalSeconds</span><span class="o">=</span><span class="n">totalSeconds</span>
                    <span class="p">,</span><span class="nb">enumerate</span><span class="o">=</span><span class="nb">enumerate</span><span class="p">,</span> <span class="nb">sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If the user wants a new quiz</span>
            <span class="n">quiz_ref</span><span class="o">.</span><span class="n">delete_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>  <span class="c1"># Deletes any existing quiz</span>
            <span class="n">questions_answers</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">generate_quiz</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>  <span class="c1"># Generates new quiz</span>
        
        <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;quizpage.html&#39;</span><span class="p">,</span> <span class="n">questions</span><span class="o">=</span><span class="n">questions_answers</span><span class="p">,</span> <span class="nb">enumerate</span><span class="o">=</span><span class="nb">enumerate</span><span class="p">,</span> <span class="nb">sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If user is not logged in</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>  <span class="c1"># Redirect them to login</span></div>

<div class="viewcode-block" id="generate_report"><a class="viewcode-back" href="../index.html#main.generate_report">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/generateReport&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">generate_report</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generates report when a quiz is submitted or user clicks on generate report</span>
<span class="sd">    in the reports tab.</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains a generated report in PDF file format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Gets date_time URL argument</span>
    <span class="n">date_time</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">reports_ref</span><span class="o">.</span><span class="n">get_report_for_date</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">date_time</span><span class="p">)</span>
        <span class="c1"># These are some options for the PDF report generator</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Quiz Results&#39;</span><span class="p">,</span>
            <span class="s1">&#39;page-size&#39;</span><span class="p">:</span> <span class="s1">&#39;Letter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;margin-top&#39;</span><span class="p">:</span> <span class="s1">&#39;1in&#39;</span><span class="p">,</span>
            <span class="s1">&#39;margin-right&#39;</span><span class="p">:</span> <span class="s1">&#39;1in&#39;</span><span class="p">,</span>
            <span class="s1">&#39;margin-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;1in&#39;</span><span class="p">,</span>
            <span class="s1">&#39;margin-left&#39;</span><span class="p">:</span> <span class="s1">&#39;1in&#39;</span><span class="p">,</span>
            <span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">date_time_submitted</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;datetimesubmitted&#39;</span><span class="p">]</span>
        <span class="c1">#Creates a DateTime object in the correct format</span>
        <span class="n">date_time_submitted</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_time_submitted</span><span class="p">,</span> <span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1"> %Y %I:%M%p&#39;</span><span class="p">)</span>
        <span class="c1">#extracts date from date_time_submitted</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date_time_submitted</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="c1">#extracts time from date_time_submitted</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">date_time_submitted</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;resultpagetemplate.html&#39;</span><span class="p">,</span> <span class="nb">enumerate</span><span class="o">=</span><span class="nb">enumerate</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">],</span>
                                   <span class="n">score</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                                   <span class="n">prefs</span><span class="o">=</span><span class="n">settings_ref</span><span class="o">.</span><span class="n">get_prefs</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])[</span><span class="s1">&#39;settings&#39;</span><span class="p">],</span> <span class="nb">sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdfkit</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/pdf&#39;</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inline; filename=output.pdf&#39;</span>

        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="logout"><a class="viewcode-back" href="../index.html#main.logout">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Logs out a user out of the session and removes the username from the </span>
<span class="sd">    session object and sends them back to the login screen.</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains main login screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">del</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>  <span class="c1"># Sends them back to login screen</span></div>


<div class="viewcode-block" id="settings"><a class="viewcode-back" href="../index.html#main.settings">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/settings&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">settings</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Presents users with a settings screen for the purpose of report generation.</span>
<span class="sd">    It includes various options like font size, and content to include.</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains settings screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#If it gets a post request, save the settings</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">settings_ref</span><span class="o">.</span><span class="n">set_prefs</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="c1">#This is a dictionary of what checkboxes and values to show in settings</span>
    <span class="n">settings_quiz_checkboxes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;q_number&#39;</span><span class="p">:</span> <span class="s1">&#39;Question numbers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;show_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Your Name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;Date Submitted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;Time submitted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="s1">&#39;Your Score&#39;</span><span class="p">,</span>
        <span class="s1">&#39;showcorrectanswer&#39;</span><span class="p">:</span> <span class="s1">&#39;Correct Answers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;showwronganswer&#39;</span><span class="p">:</span> <span class="s1">&#39;Wrong Answers&#39;</span>
    <span class="p">}</span>


    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;settings.html&#39;</span><span class="p">,</span> <span class="n">prefs</span><span class="o">=</span><span class="n">settings_ref</span><span class="o">.</span><span class="n">get_prefs</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])[</span><span class="s1">&#39;settings&#39;</span><span class="p">],</span>
                               <span class="n">user</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">settings_quiz_checkboxes</span><span class="o">=</span><span class="n">settings_quiz_checkboxes</span><span class="p">)</span></div>


<div class="viewcode-block" id="reports"><a class="viewcode-back" href="../index.html#main.reports">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/reports&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">reports</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Show the historical quiz reports that the user has taken. It also presents</span>
<span class="sd">    an option to generate PDF report for each run.</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains historical reports screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;reports.html&quot;</span><span class="p">,</span> <span class="n">reports</span><span class="o">=</span><span class="n">reports_ref</span><span class="o">.</span><span class="n">get_reports</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="analytics"><a class="viewcode-back" href="../index.html#main.analytics">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analytics&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">analytics</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generates graphs based upon the historical quiz taken by the user.</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains historical reports screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="s1">&#39;Quiz Score&#39;</span>
    <span class="n">reports</span><span class="o">=</span><span class="n">reports_ref</span><span class="o">.</span><span class="n">get_reports</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reports</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">reports</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span> <span class="p">:</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;analytics.html&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;legend&#39;</span> <span class="p">:</span> <span class="n">legend</span><span class="p">,</span>
                    <span class="s1">&#39;labels&#39;</span> <span class="p">:</span> <span class="n">labels</span><span class="p">,</span>
                    <span class="s1">&#39;values&#39;</span> <span class="p">:</span> <span class="n">values</span>
                    <span class="p">})</span></div>


<div class="viewcode-block" id="update_current_quiz_state"><a class="viewcode-back" href="../index.html#main.update_current_quiz_state">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/updateCurrentQuizState&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update_current_quiz_state</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Updates user&#39;s current quiz in progress as and when user changes </span>
<span class="sd">    anything. This function updates the quiz state in the database.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="n">quiz_ref</span><span class="o">.</span><span class="n">update_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">())</span>
            <span class="k">return</span> <span class="s2">&quot;Saved&quot;</span></div>



<div class="viewcode-block" id="get_help"><a class="viewcode-back" href="../index.html#main.get_help">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getHelp&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_help</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Intelligent Q&amp;A feature: This gets called when user types a</span>
<span class="sd">    question in get help chat window. It uses Naive Bayes algorithm</span>
<span class="sd">    to classify what category the question falls in and based upon that</span>
<span class="sd">    it returns the corrresponding help related to that category. The</span>
<span class="sd">    categories and corresponding help is stored in the database.</span>
<span class="sd">    Example::</span>
<span class="sd">            User types a question: How can I customize font in reports ?</span>
<span class="sd">            Category: reportgeneration</span>
<span class="sd">    </span>
<span class="sd">    :return: List of questions and answers corresponding to category of the </span>
<span class="sd">             question that user has asked.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">qa</span> <span class="o">=</span> <span class="n">intelligent_qa_ref</span><span class="o">.</span><span class="n">get_help</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">qa</span><span class="p">)</span> <span class="c1">#Returns a JSON object</span></div>


<div class="viewcode-block" id="quiz_in_progress_exists"><a class="viewcode-back" href="../index.html#main.quiz_in_progress_exists">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/quizInProgressExists&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">quiz_in_progress_exists</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Checks if there&#39;s a current quiz in progress for the user.</span>
<span class="sd">    </span>
<span class="sd">    :return: True if the user has a quiz in progress, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quiz</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">get_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">quiz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;False&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;True&quot;</span></div>


<div class="viewcode-block" id="about_page"><a class="viewcode-back" href="../index.html#main.about_page">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">about_page</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Shows About Page with description about FBLA Quizzer and the developer</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains about page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;aboutpage.html&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="help"><a class="viewcode-back" href="../index.html#main.help">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/help&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Shows FAQs</span>
<span class="sd">    </span>
<span class="sd">    :return: Response object that contains FAQs page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;helppage.html&#39;</span><span class="p">,</span> <span class="n">faqs</span><span class="o">=</span><span class="n">intelligent_qa_ref</span><span class="o">.</span><span class="n">get_frequently_asked_questions</span><span class="p">())</span></div>

<div class="viewcode-block" id="get_started"><a class="viewcode-back" href="../index.html#main.get_started">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getStarted&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_started</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Shows a list of instructions to get started using FBLA Quiz</span>

<span class="sd">    :return: Response object that contains Get Started HTML page</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;getstarted.html&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="save_and_get_quiz_results"><a class="viewcode-back" href="../index.html#main.save_and_get_quiz_results">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/saveAndGetQuizResults&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">save_and_get_quiz_results</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function checks the quiz, saves the results, and sends back the results, </span>
<span class="sd">    which include the questions, answers, and the user&#39;s responses.</span>

<span class="sd">    :return: JSON object which contains url for PDF report, score, and results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span>
        <span class="n">timetaken</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;timetaken&#39;</span><span class="p">]</span>
        <span class="n">quiz_in_progress</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">get_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
        <span class="n">questions_answers</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">get_correct_answers</span><span class="p">(</span><span class="n">quiz_in_progress</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">questions_answers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">questions_answers</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="c1">#print(results)</span>
            <span class="n">date_time</span> <span class="o">=</span> <span class="n">quiz_ref</span><span class="o">.</span><span class="n">save_results</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">,</span>
                                              <span class="n">score</span><span class="p">,</span> <span class="n">timetaken</span><span class="p">)</span>  <span class="c1"># saves results and returns the datetime</span>
            <span class="n">quiz_ref</span><span class="o">.</span><span class="n">delete_quiz_in_progress</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>  <span class="c1"># Deletes the quiz in progress</span>

            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;url&#39;</span> <span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;generate_report&#39;</span><span class="p">,</span>
                                    <span class="n">datetime</span><span class="o">=</span><span class="n">date_time</span><span class="p">),</span>
                            <span class="s1">&#39;score&#39;</span> <span class="p">:</span> <span class="n">score</span><span class="p">,</span>
                            <span class="s1">&#39;results&#39;</span> <span class="p">:</span> <span class="n">results</span><span class="p">})</span>  <span class="c1"># Sends them to the report generation page with the date and time the quiz was submitted as the url argument</span></div>

<span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">quiz_ref</span> <span class="o">=</span> <span class="n">Quiz</span><span class="p">()</span>
<span class="n">settings_ref</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
<span class="n">reports_ref</span> <span class="o">=</span> <span class="n">Reports</span><span class="p">()</span>
<span class="n">intelligent_qa_ref</span> <span class="o">=</span> <span class="n">IntelligentQA</span><span class="p">()</span>
<span class="c1">#app.run(&#39;localhost&#39;)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Reyansh Bahl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>